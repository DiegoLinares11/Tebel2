name: Run tests and backend


on:
    push:
      branches: ['main']  # Tambi√©n puedes especificar otras ramas si lo deseas
    pull_request:
      branches: ['main']
    workflow_dispatch:

jobs:
  frontend-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node for Frontend
        uses: actions/setup-node@v3
        with:
          node-version: 18.19.1

      - name: Install Frontend Dependencies
        run: |
          cd Scrum/fronted
          npm install

      - name: Run Frontend Tests
        run: |
          cd Scrum/fronted
          npm test

  backend-tests:
    runs-on: ubuntu-latest
    needs: frontend-tests

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Docker Compose
        run: |
          docker-compose -f docker-compose.yml up -d

      - name: Install Composer Dependencies
        run: |
          docker exec -T backend-container-name composer install --prefer-dist --no-progress --no-suggest

      - name: Set up Environment
        run: |
          docker exec -T backend-container-name cp .env.example .env
          docker exec -T backend-container-name php artisan key:generate

      - name: Run Migrations (Optional)
        run: |
          docker exec -T backend-container-name php artisan migrate --force

      - name: Run Backend Tests
        run: |
          docker exec -T backend-container-name php artisan test

      - name: Shut down Docker Compose
        run: |
          docker-compose -f docker-compose.yml down